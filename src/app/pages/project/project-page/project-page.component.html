<div class="app-project-page main-bg">
  <div *ngIf="isEditing; then editingPage; else displayPage"></div>
  <ng-template #editingPage>
    <form [formGroup]="form" enctype="multipart/form-data">
      <div class="app-project-page banner-container">
        <app-image-upload #bannerUpload [imageSrc]="getFileLink(projectEdits.bannerLink)" [fileSizeLimitMB]="10"></app-image-upload>
      </div>
      <div class="app-project-page content-width-padding">
        <div class="app-project-page content">
          <div breakable-styles 
            style="
              position: relative;
              display: flex; 
              margin-top: 2em; 
              flex-wrap: wrap; 
              width: 100%;
              gap: 2em;
            "
            prebreak-style="
              flex-direction: row; 
            "
            break-style="
              flex-direction: column;
            "
            break-on="width < 840"
          >
            <div class="app-project-page card-offset">
              <div class="app-project-page card-image-container">
                <app-image-upload #cardImageUpload [imageSrc]="getFileLink(project.cardImageLink)" [fileSizeLimitMB]="5" class="app-project-page card-image"></app-image-upload>
              </div>
            </div>
            <div style="
              flex: 1 1 0;
              display: flex;
              flex-direction: column;
              max-width: 100%;
            ">
              <div style="
                display: flex;
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: left;
                align-items: flex-start;
                margin-bottom: 16px;
                gap: 24px;
              ">
                <mat-form-field appearance="outline" style="flex: 1;">
                  <mat-label>Project Name</mat-label>
                  <input matInput formControlName="name">
                  <mat-error *ngIf="form.get('name')?.hasError('required')">
                    Project name is required
                  </mat-error>
                </mat-form-field>
                <div style=" 
                  display: flex;
                  flex-direction: row;
                  gap: 10px;
                  justify-content: center;
                ">
                  <button class="app-project-page edit-button" mat-stroked-button color="basic" pill (click)="exitEdit()" [disabled]="processing">Exit
                  </button>
                  <button class="app-project-page edit-button" mat-stroked-button color="basic" pill (click)="save()" [disabled]="processing">Save Project
                  </button>
                </div>
              </div>
              <mat-form-field appearance="outline" style="width: 100%; line-height: 1.5em" class="no-padding">
                <mat-label>Pitch</mat-label>
                <textarea matInput
                          cdkTextareaAutosize
                          cdkAutosizeMinRows="1"
                          cdkAutosizeMaxRows="5"
                          formControlName="pitch"></textarea>
                <mat-error *ngIf="form.get('pitch')?.hasError('required')">
                  Pitch is required
                </mat-error>
              </mat-form-field>
            </div>
          </div>
          <div class="app-project-page core-content">
            <div class="margin-top: 16px">
              <mat-form-field appearance="outline" style="width: 100%; line-height: 1.5em">
                <mat-label>Description</mat-label>
                <textarea matInput
                          cdkTextareaAutosize
                          cdkAutosizeMinRows="10"
                          formControlName="description"></textarea>
                <mat-error *ngIf="form.get('description')?.hasError('required')">
                  Description is required
                </mat-error>
              </mat-form-field>
            </div>
            <div *ngIf="nonExistent">
              <h1>This account doesn't exist</h1>
              <p class="app-project-page no-results-text">Try searching for another</p>
            </div>
            <mat-divider></mat-divider>
            <h2>Members</h2>
            <app-project-members-input></app-project-members-input>
          </div>
        </div>
      </div>
    </form>
  </ng-template>
  <ng-template #displayPage>
    <div class="app-project-page banner-container">
      <img [src]="getFileLink(project.bannerLink ?? '')" class="app-project-page banner">
    </div>
    <div class="app-project-page content-width-padding">
      <div class="app-project-page content">
        <div breakable-styles 
          style="
            position: relative;
            display: flex; 
            margin-top: 2em; 
            flex-wrap: wrap; 
            width: 100%;
            gap: 2em;
          "
          prebreak-style="
            flex-direction: row; 
          "
          break-style="
            flex-direction: column;
          "
          break-on="width < 840"
        >
          <div class="app-project-page card-offset">
            <div class="app-project-page card-image-container">
              <img [src]="getFileLink(project.cardImageLink ?? '')" class="app-project-page card-image">
            </div>
          </div>
          <div style="
            flex: 1 1 0;
            display: flex;
            flex-direction: column;
            max-width: 100%;
          ">
            <div style="
              display: flex;
              flex-direction: row;
              flex-wrap: wrap;
              justify-content: left;
              align-items: flex-start;
              margin-bottom: 16px;
              gap: 8px;
            ">
              <h1 class="app-project-page name" style="
                margin-bottom: 0px;
                flex: 1;
              ">{{ project.name }}</h1>
              <button class="app-project-page edit-button" mat-stroked-button color="basic" pill (click)="edit()">Edit Project
              </button>
            </div>
            <p class="app-project-page pitch">
              {{ project.pitch }}
            </p>
          </div>
        </div>
        <div class="app-project-page core-content">
          <div class="margin-top: 16px">
            <markdown katex lineNumbers *ngIf="isMarkdownReady">
              {{ project.description }}
            </markdown>
          </div>
          <div *ngIf="nonExistent">
            <h1>This account doesn't exist</h1>
            <p class="app-project-page no-results-text">Try searching for another</p>
          </div>
          <mat-divider></mat-divider>
          <h2>Members</h2>
          <app-project-members-display [projectMembers]="getProjectMembers()"></app-project-members-display>
        </div>
      </div>
    </div>
  </ng-template>
</div>