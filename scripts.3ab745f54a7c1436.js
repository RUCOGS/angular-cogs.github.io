"use strict";function _typeof(n){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(s){return typeof s}:function(s){return s&&"function"==typeof Symbol&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s})(n)}function _classCallCheck(n,s){if(!(n instanceof s))throw new TypeError("Cannot call a class as a function")}function _defineProperties(n,s){for(var e,t=0;t<s.length;t++)(e=s[t]).enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(n,e.key,e)}function _createClass(n,s,e){return s&&_defineProperties(n.prototype,s),e&&_defineProperties(n,e),n}var FlipDown=function(){var n=Math.floor;function s(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"flipdown",o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(_classCallCheck(this,s),"number"!=typeof e)throw new Error("FlipDown: Constructor expected unix timestamp, got ".concat(_typeof(e)," instead."));"object"===_typeof(t)&&(o=t,t="flipdown"),this.version="0.3.2",this.initialised=!1,this.now=this._getTime(),this.epoch=e,this.countdownEnded=!1,this.hasEndedCallback=null,this.element=document.getElementById(t),this.rotors=[],this.rotorLeafFront=[],this.rotorLeafRear=[],this.rotorTops=[],this.rotorBottoms=[],this.countdown=null,this.daysRemaining=0,this.clockValues={},this.clockStrings={},this.clockValuesAsString=[],this.prevClockValuesAsString=[],this.opts=this._parseOptions(o),this._setOptions(),console.log("FlipDown ".concat(this.version," (Theme: ").concat(this.opts.theme,")"))}return _createClass(s,[{key:"start",value:function(){return this.initialised||this._init(),this.countdown=setInterval(this._tick.bind(this),1e3),this}},{key:"ifEnded",value:function(t){return this.hasEndedCallback=function(){t(),this.hasEndedCallback=null},this}},{key:"_getTime",value:function(){return(new Date).getTime()/1e3}},{key:"_hasCountdownEnded",value:function(){return 0>this.epoch-this.now?(this.countdownEnded=!0,null!=this.hasEndedCallback&&(this.hasEndedCallback(),this.hasEndedCallback=null),!0):(this.countdownEnded=!1,!1)}},{key:"_parseOptions",value:function(t){var o=["Days","Hours","Minutes","Seconds"];return t.headings&&4===t.headings.length&&(o=t.headings),{theme:t.hasOwnProperty("theme")?t.theme:"dark",headings:o}}},{key:"_setOptions",value:function(){this.element.classList.add("flipdown__theme-".concat(this.opts.theme))}},{key:"_init",value:function(){this.initialised=!0,this.daysremaining=this._hasCountdownEnded()?0:n((this.epoch-this.now)/86400).toString().length;for(var t=2>=this.daysremaining?2:this.daysremaining,o=0;o<t+6;o++)this.rotors.push(this._createRotor(0));var a=[];for(o=0;o<t;o++)a.push(this.rotors[o]);this.element.appendChild(this._createRotorGroup(a,0));var l,r=t;for(o=0;3>o;o++){l=[];for(var i=0;2>i;i++)l.push(this.rotors[r]),r++;this.element.appendChild(this._createRotorGroup(l,o+1))}return this.rotorLeafFront=Array.prototype.slice.call(this.element.getElementsByClassName("rotor-leaf-front")),this.rotorLeafRear=Array.prototype.slice.call(this.element.getElementsByClassName("rotor-leaf-rear")),this.rotorTop=Array.prototype.slice.call(this.element.getElementsByClassName("rotor-top")),this.rotorBottom=Array.prototype.slice.call(this.element.getElementsByClassName("rotor-bottom")),this._tick(),this._updateClockValues(!0),this}},{key:"_createRotorGroup",value:function(t,o){var a=document.createElement("div");a.className="rotor-group";var l=document.createElement("div");return l.className="rotor-group-heading",l.setAttribute("data-before",this.opts.headings[o]),a.appendChild(l),appendChildren(a,t),a}},{key:"_createRotor",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,o=document.createElement("div"),a=document.createElement("div"),l=document.createElement("figure"),r=document.createElement("figure"),i=document.createElement("div"),c=document.createElement("div");return o.className="rotor",a.className="rotor-leaf",l.className="rotor-leaf-rear",r.className="rotor-leaf-front",i.className="rotor-top",c.className="rotor-bottom",l.textContent=t,i.textContent=t,c.textContent=t,appendChildren(o,[a,i,c]),appendChildren(a,[l,r]),o}},{key:"_tick",value:function(){this.now=this._getTime();var t=0>=this.epoch-this.now?0:this.epoch-this.now;this.clockValues.d=n(t/86400),this.clockValues.h=n((t-=86400*this.clockValues.d)/3600),this.clockValues.m=n((t-=3600*this.clockValues.h)/60),this.clockValues.s=n(t-=60*this.clockValues.m),this._updateClockValues(),this._hasCountdownEnded()}},{key:"_updateClockValues",value:function(){function t(){var r=this;this.rotorTop.forEach(function(i,c){i.textContent!=r.clockValuesAsString[c]&&(i.textContent=r.clockValuesAsString[c])})}function o(){var r=this;this.rotorLeafRear.forEach(function(i,c){if(i.textContent!=r.clockValuesAsString[c]){i.textContent=r.clockValuesAsString[c],i.parentElement.classList.add("flipped");var h=setInterval(function(){i.parentElement.classList.remove("flipped"),clearInterval(h)}.bind(r),500)}})}var a=this,l=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this.clockStrings.d=pad(this.clockValues.d,2),this.clockStrings.h=pad(this.clockValues.h,2),this.clockStrings.m=pad(this.clockValues.m,2),this.clockStrings.s=pad(this.clockValues.s,2),this.clockValuesAsString=(this.clockStrings.d+this.clockStrings.h+this.clockStrings.m+this.clockStrings.s).split(""),this.rotorLeafFront.forEach(function(r,i){r.textContent=a.prevClockValuesAsString[i]}),this.rotorBottom.forEach(function(r,i){r.textContent=a.prevClockValuesAsString[i]}),l?(t.call(this),o.call(this)):(setTimeout(t.bind(this),500),setTimeout(o.bind(this),500)),this.prevClockValuesAsString=this.clockValuesAsString}}]),s}();function pad(n,s){return(n=n.toString()).length<s?pad("0"+n,s):n}function appendChildren(n,s){s.forEach(function(e){n.appendChild(e)})}